<!DOCTYPE html>
{% load static %}
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ç™¾åº¦ç‰™ç§‘ç™¾ç§‘{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ç™¾åº¦é£æ ¼æ ·å¼ -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="container">
            <div class="header-top">
                <div class="logo">
                    <a href="{% url 'encyclopedia:index' %}">
                        <img src="{% static 'images/logo.svg' %}" alt="ç™¾åº¦ç‰™ç§‘ç™¾ç§‘" class="logo-img">
                        <span class="logo-text">ç™¾åº¦ç‰™ç§‘ç™¾ç§‘</span>
                    </a>
                </div>
                
                <!-- æœç´¢æ¡† -->
                <div class="search-box">
                    <form action="{% url 'encyclopedia:entry_list' %}" method="get">
                        <div class="search-input-group">
                            <input type="text" name="q" placeholder="æœç´¢ç‰™ç§‘çŸ¥è¯†" value="{{ search_query }}" class="search-input">
                            <button type="submit" class="search-btn">
                                <i class="search-icon">ğŸ”</i>
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- ç”¨æˆ·èœå• -->
                <div class="user-menu">
                    {% if user.is_authenticated %}
                        <div class="dropdown">
                            <button class="user-btn">
                                {{ user.username }}
                            </button>
                            <div class="dropdown-menu">
                                <a href="#" class="dropdown-item">ä¸ªäººä¸­å¿ƒ</a>
                                <a href="{% url 'encyclopedia:create_entry' %}" class="dropdown-item">åˆ›å»ºè¯æ¡</a>
                                <a href="{% url 'admin:index' %}" class="dropdown-item">ç®¡ç†åå°</a>
                                <form action="{% url 'admin:logout' %}" method="post" class="dropdown-item">
                                    {% csrf_token %}
                                    <button type="submit" class="logout-btn">é€€å‡ºç™»å½•</button>
                                </form>
                            </div>
                        </div>
                    {% else %}
                        <a href="{% url 'admin:index' %}" class="login-btn">ç™»å½•</a>
                    {% endif %}
                </div>
            </div>
            
            <!-- ä¸»å¯¼èˆª -->
            <nav class="main-nav">
            <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                â˜°
            </button>
            
            <ul class="nav-list" id="navLinks">
                <li class="nav-item"><a href="{% url 'encyclopedia:index' %}" class="nav-link">é¦–é¡µ</a></li>
                <li class="nav-item"><a href="{% url 'encyclopedia:entry_list' %}" class="nav-link">å…¨éƒ¨è¯æ¡</a></li>
                <li class="nav-item"><a href="{% url 'encyclopedia:category_list' %}" class="nav-link">åˆ†ç±»æµè§ˆ</a></li>
                <li class="nav-item"><a href="{% url 'encyclopedia:popular_entries' %}" class="nav-link">çƒ­é—¨è¯æ¡</a></li>
            </ul>
        </nav>
        
        <script>
            // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const navLinks = document.getElementById('navLinks');
            
            if (mobileMenuBtn && navLinks) {
                mobileMenuBtn.addEventListener('click', function() {
                    navLinks.classList.toggle('show');
                    // åˆ‡æ¢èœå•å›¾æ ‡
                    this.textContent = navLinks.classList.contains('show') ? 'âœ•' : 'â˜°';
                });
                
                // ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸå…³é—­èœå•
                document.addEventListener('click', function(event) {
                    if (!mobileMenuBtn.contains(event.target) && !navLinks.contains(event.target)) {
                        navLinks.classList.remove('show');
                        mobileMenuBtn.textContent = 'â˜°';
                    }
                });
            }
        </script>
        </div>
    </header>

    <!-- æ¶ˆæ¯æç¤º -->
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="message {% if message.tags %}message-{{ message.tags }}{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="main-content">
        <div class="container">
            <div class="content-wrapper">
                <!-- ä¸»è¦å†…å®¹ -->
                <div class="content">
                    {% block content %}{% endblock %}
                </div>
                
                <!-- ä¾§è¾¹æ  -->
                <aside class="sidebar">
                    {% block sidebar %}
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">åˆ†ç±»å¯¼èˆª</h3>
                        <ul class="category-list">
                            {% for category in categories %}
                            <li class="category-item">
                                {% if category.slug %}
                                <a href="{% url 'encyclopedia:entry_list_by_category' category.slug %}" class="category-link">
                                    {{ category.name }}
                                    <span class="entry-count">({{ category.entries.count }})</span>
                                </a>
                                {% else %}
                                <span class="category-link disabled">
                                    {{ category.name }}
                                    <span class="entry-count">({{ category.entries.count }})</span>
                                </span>
                                {% endif %}
                            </li>
                            {% empty %}
                            <li class="category-item">æš‚æ— åˆ†ç±»</li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">çƒ­é—¨è¯æ¡</h3>
                        <ul class="hot-entries">
                            {% for entry in popular_entries|default:latest_entries %}  
                            <li class="hot-entry-item">
                                <a href="{% url 'encyclopedia:entry_detail' entry.slug %}" class="hot-entry-link">
                                    {{ entry.title }}
                                </a>
                                <span class="view-count">{{ entry.view_count }}æ¬¡æµè§ˆ</span>
                            </li>
                            {% empty %}
                            <li class="hot-entry-item">æš‚æ— è¯æ¡</li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    {% if user.is_authenticated %}
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">å¿«æ·æ“ä½œ</h3>
                        <ul class="quick-actions">
                            <li class="action-item">
                                <a href="{% url 'encyclopedia:create_entry' %}" class="action-link">
                                    <i class="action-icon">âœï¸</i> åˆ›å»ºè¯æ¡
                                </a>
                            </li>
                        </ul>
                    </div>
                    {% endif %}
                    {% endblock %}
                </aside>
            </div>
        </div>
    </main>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <p class="copyright">Â© 2024 ç™¾åº¦ç‰™ç§‘ç™¾ç§‘ - å£è…”åŒ»å­¦çŸ¥è¯†åˆ†äº«å¹³å°</p>
                    <p class="about">æœ¬å¹³å°æä¾›ä¸“ä¸šçš„ç‰™ç§‘åŒ»ç–—çŸ¥è¯†ï¼Œå†…å®¹ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç”Ÿè¯Šæ–­</p>
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link">å…³äºæˆ‘ä»¬</a>
                    <a href="#" class="footer-link">ä½¿ç”¨å¸®åŠ©</a>
                    <a href="#" class="footer-link">éšç§æ”¿ç­–</a>
                    <a href="#" class="footer-link">è”ç³»æˆ‘ä»¬</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- è‡ªå®šä¹‰JS -->
    <script src="{% static 'js/script.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>